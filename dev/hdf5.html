<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>File storage · Vahana Documentation</title><meta name="title" content="File storage · Vahana Documentation"/><meta property="og:title" content="File storage · Vahana Documentation"/><meta property="twitter:title" content="File storage · Vahana Documentation"/><meta name="description" content="Documentation for Vahana Documentation."/><meta property="og:description" content="Documentation for Vahana Documentation."/><meta property="twitter:description" content="Documentation for Vahana Documentation."/><script data-outdated-warner src="assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="assets/documenter.js"></script><script src="search_index.js"></script><script src="siteinfo.js"></script><script src="../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="index.html">Vahana Documentation</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="index.html">Introduction</a></li><li><span class="tocitem">Tutorials</span><ul><li><a class="tocitem" href="tutorial1.html">First Steps</a></li><li><a class="tocitem" href="hegselmann.html">Utilizing Graphs.jl</a></li><li><a class="tocitem" href="predator.html">Adding Spatial Information</a></li></ul></li><li><a class="tocitem" href="performance.html">Performance Tuning</a></li><li><a class="tocitem" href="parallel.html">Parallel Simulations</a></li><li><span class="tocitem">API</span><ul><li><a class="tocitem" href="definition.html">Model Definition</a></li><li><a class="tocitem" href="initialization.html">Initialization</a></li><li><a class="tocitem" href="transition.html">Transition Function</a></li><li><a class="tocitem" href="global.html">Global Layer</a></li><li><a class="tocitem" href="raster.html">Raster</a></li><li><a class="tocitem" href="plots.html">Plots</a></li><li class="is-active"><a class="tocitem" href="hdf5.html">File storage</a><ul class="internal"><li><a class="tocitem" href="#Write"><span>Write</span></a></li><li><a class="tocitem" href="#Read"><span>Read</span></a></li><li><a class="tocitem" href="#Transition"><span>Transition</span></a></li><li><a class="tocitem" href="#Metadata"><span>Metadata</span></a></li><li><a class="tocitem" href="#Restrictions-and-Workarounds"><span>Restrictions and Workarounds</span></a></li><li><a class="tocitem" href="#Example-Model"><span>Example Model</span></a></li></ul></li><li><a class="tocitem" href="logging.html">Logging</a></li><li><a class="tocitem" href="config.html">Configuration</a></li><li><a class="tocitem" href="misc.html">Misc</a></li><li><a class="tocitem" href="apiindex.html">Index</a></li></ul></li><li><a class="tocitem" href="changelog.html">Change Log</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">API</a></li><li class="is-active"><a href="hdf5.html">File storage</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href="hdf5.html">File storage</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/s-fuerst/Vahana.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/s-fuerst/Vahana.jl/blob/0ca824a970a7f994511cb0de07410556b689f1dd/docs/src/hdf5.md" title="View source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="HDF5-data-storage"><a class="docs-heading-anchor" href="#HDF5-data-storage">HDF5 data storage</a><a id="HDF5-data-storage-1"></a><a class="docs-heading-anchor-permalink" href="#HDF5-data-storage" title="Permalink"></a></h1><p>Vahana uses the Hierarchical Data Format version 5 (HDF5) as file format to store simulations to disc, utilizing the HDF5.jl libary. HDF5.jl again uses a C library, which is either installed with HDF5.jl or can be provided by the system. Please check the <a href="https://juliaio.github.io/HDF5.jl/stable/#Installation">HDF5.jl documentation</a> for details.</p><p>If the provided library supports Parallel HDF5, this will be used automatically. Using Parallel HDF5 has the advantage that all processes can write to a single file, without Parallel HDF5 multiple files are created for a single (parallel) simulation (but the Vahana API is the same in any case, so for the user this difference is only visible when looking into the h5 directory with a file manager or via the shell). But in the current Vahana version using Parallel HDF5 has the disadvantage, that the files are not compressed (see also <a href="config.html#Vahana.set_compression"><code>set_compression</code></a>).</p><h2 id="Write"><a class="docs-heading-anchor" href="#Write">Write</a><a id="Write-1"></a><a class="docs-heading-anchor-permalink" href="#Write" title="Permalink"></a></h2><p>To write into a HDF5 file, they are <code>attached</code> to a Vahama simulation. Normally this happens automatically when the first time a write function like <a href="hdf5.html#Vahana.write_snapshot"><code>write_snapshot</code></a> is called. All following <code>write_*</code> calls then add additional datasets to the file.</p><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Vahana.set_hdf5_path" href="#Vahana.set_hdf5_path"><code>Vahana.set_hdf5_path</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">set_hdf5_path(path::String)</code></pre><p>Specify the path that is used to save and read the hdf5 files. If the directory does not exist, it is created the first time a file is written or tried to read.</p><p>See also <a href="hdf5.html#Vahana.create_h5file!"><code>create_h5file!</code></a></p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/s-fuerst/Vahana.jl/blob/0ca824a970a7f994511cb0de07410556b689f1dd/src/Vahana.jl#L123-L131">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Vahana.write_snapshot" href="#Vahana.write_snapshot"><code>Vahana.write_snapshot</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">write_snapshot(sim::Simulation, [comment::String = &quot;&quot;; ignore = []])</code></pre><p>Writes the current state of the simulation <code>sim</code> to the attached HDF5 file. <code>comment</code> can be used to identify the snapshot via <a href="hdf5.html#Vahana.list_snapshots"><code>list_snapshots</code></a>, and to read this snapshot via the <a href="hdf5.html#Vahana.read_snapshot!"><code>read_snapshot!</code></a> function by utilizing the <code>comment</code> keyword of this function.</p><p><code>ignore</code> is a list of agent and/or edge types, that should not be written.</p><p>See also <a href="hdf5.html#Vahana.create_h5file!"><code>create_h5file!</code></a>, <a href="hdf5.html#Vahana.read_snapshot!"><code>read_snapshot!</code></a></p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/s-fuerst/Vahana.jl/blob/0ca824a970a7f994511cb0de07410556b689f1dd/src/HDF5.jl#L674-L686">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Vahana.create_h5file!" href="#Vahana.create_h5file!"><code>Vahana.create_h5file!</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">create_h5file!(sim::Simulation, [filename = sim.filename; overwrite = sim.overwrite_file])</code></pre><p>The canonical way to create an HDF5 file is to call one of the <code>write_</code> functions like <a href="hdf5.html#Vahana.write_snapshot"><code>write_snapshot</code></a>. If <code>sim</code> does not already have an HDF5 file attached, such a file will then be created automatically using the filename specified as keyword in <a href="definition.html#Vahana.create_simulation"><code>create_simulation</code></a> or, if this keyword was not given, the model name. But sometime it can be useful to control this manually, e.g. after a call to <a href="misc.html#Vahana.copy_simulation"><code>copy_simulation</code></a>.</p><p>The <code>filename</code> argument can be used to specify a filename other than <code>sim.filename</code>. If <code>overwrite</code> is true, existing files with this name will be overwritten. If it is false, the filename is automatically extended by an increasing 6-digit number, so that existing files are not overwritten.</p><p>By default, the files are created in an <code>h5</code> subfolder, and this is created in the current working directory. However, the path can also be set with the function <code>set_hdf5_path</code>.</p><p>In the case that an HDF5 file was already created for the simulation <code>sim</code>, this will be closed.</p><p><code>create_h5file!</code> can be only called after <a href="initialization.html#Vahana.finish_init!"><code>finish_init!</code></a></p><p>See also <a href="hdf5.html#Vahana.close_h5file!"><code>close_h5file!</code></a>, <a href="hdf5.html#Vahana.write_agents"><code>write_agents</code></a>, <a href="hdf5.html#Vahana.write_edges"><code>write_edges</code></a>, <a href="hdf5.html#Vahana.write_globals"><code>write_globals</code></a>, <a href="hdf5.html#Vahana.read_agents!"><code>read_agents!</code></a>, <a href="hdf5.html#Vahana.read_edges!"><code>read_edges!</code></a>, <a href="hdf5.html#Vahana.read_globals"><code>read_globals</code></a>, <a href="hdf5.html#Vahana.read_snapshot!"><code>read_snapshot!</code></a> and <a href="hdf5.html#Vahana.list_snapshots"><code>list_snapshots</code></a></p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/s-fuerst/Vahana.jl/blob/0ca824a970a7f994511cb0de07410556b689f1dd/src/HDF5.jl#L139-L169">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Vahana.close_h5file!" href="#Vahana.close_h5file!"><code>Vahana.close_h5file!</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">close_h5file!(sim::Simulation)</code></pre><p>Closes the HDF5 file attached to the simulation <code>sim</code>.</p><p>Be aware that a following call to one of the <code>write_</code> functions like <a href="hdf5.html#Vahana.write_snapshot"><code>write_snapshot</code></a> will automatically create a new file and, depending on the <code>overwrite_file</code> argument of <a href="definition.html#Vahana.create_simulation"><code>create_simulation</code></a> also overwrites to closed file.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/s-fuerst/Vahana.jl/blob/0ca824a970a7f994511cb0de07410556b689f1dd/src/HDF5.jl#L329-L338">source</a></section></article><p>Beside <code>write_snapshot</code> there exists also some more fine grained write functions:</p><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Vahana.write_agents" href="#Vahana.write_agents"><code>Vahana.write_agents</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">write_agents(sim::Simulation, [types])</code></pre><p>Writes the current agent state to the attached HDF5 file. If only the agents of a subset of agent types are to be written, this subset can be specified via the optional <code>types</code> argument.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/s-fuerst/Vahana.jl/blob/0ca824a970a7f994511cb0de07410556b689f1dd/src/HDF5.jl#L475-L481">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Vahana.write_edges" href="#Vahana.write_edges"><code>Vahana.write_edges</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">write_edges(sim::Simulation, [types])</code></pre><p>Writes the current edge states to the attached HDF5 file. If only the edges of a subset of edge types are to be written, this subset can be specified via the optional <code>types</code> argument.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/s-fuerst/Vahana.jl/blob/0ca824a970a7f994511cb0de07410556b689f1dd/src/HDF5.jl#L569-L575">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Vahana.write_globals" href="#Vahana.write_globals"><code>Vahana.write_globals</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">write_globals(sim::Simulation, [fields])</code></pre><p>Writes the current global values to the attached HDF5 file. If only a subset of the fields is to be written, this subset can be specified via the optional <code>fields</code> argument.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/s-fuerst/Vahana.jl/blob/0ca824a970a7f994511cb0de07410556b689f1dd/src/HDF5.jl#L353-L359">source</a></section></article><h2 id="Read"><a class="docs-heading-anchor" href="#Read">Read</a><a id="Read-1"></a><a class="docs-heading-anchor-permalink" href="#Read" title="Permalink"></a></h2><p>In the normal use case we call just <code>write_snapshot(sim, &quot;snapshot description&quot;)</code> (assuming sim is a Vahama simulation). To read such a snapshot, we can then run another Script that creates the same model (see <a href="definition.html#Vahana.create_model"><code>create_model</code></a>) and simulation (see <a href="definition.html#Vahana.create_simulation"><code>create_simulation</code></a>) and then call <code>read_snapshot!(sim)</code>. <a href="hdf5.html#Vahana.read_snapshot!"><code>read_snapshot!</code></a> can read also a parallel simulation into a single (REPL) process, then the distributed graph is merged into a single one.</p><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Vahana.read_snapshot!" href="#Vahana.read_snapshot!"><code>Vahana.read_snapshot!</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">read_snapshot!(sim::Simulation, [name::String; transition = typemax(Int64), comment = &quot;&quot;, writeable = false, ignore_params = false])
read_snapshot!(sim::Simulation, nr::Int64; [transition = typemax(Int64), comment = &quot;&quot;, writeable = false, ignore_params = false])</code></pre><p>Read a complete snapshot from a file into the simulation <code>sim</code>. If <code>name</code> is given, the snapshot is read from the file with this filename from the <code>h5</code> subfolder of the current working directory.  In the other case the filename from the <a href="definition.html#Vahana.create_simulation"><code>create_simulation</code></a> call is used.</p><p>If the <code>overwrite_file</code> argument of <a href="definition.html#Vahana.create_simulation"><code>create_simulation</code></a> is set to true, and the file names are supplemented with a number, the number of the meant file can be specified via the <code>nr</code> argument.</p><p>Per default, the last written snapshot is read. The <code>transition</code> keyword allows to read also earlier versions. Alternatively, the comment that was specified when write_snapshot was called can be specified with the <code>comment</code> keyword to read the corresponding snapshot.</p><p>If <code>writeable</code> is set to true, the file is also attached to the simulation and following <code>write_</code> functions like <a href="hdf5.html#Vahana.write_snapshot"><code>write_snapshot</code></a> will be append to the file.</p><p>If <code>ignore_params</code> is set to true, the parameters of <code>sim</code> will not be changed.</p><p>Returns false when no snapshot was found </p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/s-fuerst/Vahana.jl/blob/0ca824a970a7f994511cb0de07410556b689f1dd/src/HDF5.jl#L1548-L1576">source</a></section></article><p>Also here exists also some more fine grained read functions:</p><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Vahana.read_params" href="#Vahana.read_params"><code>Vahana.read_params</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">read_params(filename::String, T::DataType)
read_params(sim::Simulation, T::DataType)
read_params(sim::Simulation, nr::Int64, T::DataType)
read_params(filename::String)</code></pre><p>Read the parameters from an HDF5 file. If <code>filename</code> is given, the parameters are read from the file with this filename from the <code>h5</code> subfolder of the current working directory.</p><p>If a simulation <code>sim</code> is given instead, the filename from the <a href="definition.html#Vahana.create_simulation"><code>create_simulation</code></a> call is used.</p><p>If the <code>overwrite_file</code> argument of <a href="definition.html#Vahana.create_simulation"><code>create_simulation</code></a> is set to true, and the file names are supplemented with a number, the number of the meant file can be specified via the <code>nr</code> argument.</p><p>In the case that the DataType <code>T</code> of the argument <code>globals</code> of <a href="definition.html#Vahana.create_simulation"><code>create_simulation</code></a> used for the simulation is specified, the result will be an instance of T, elsewhere it will be a Dict with the fields of the written Globals type as keys.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/s-fuerst/Vahana.jl/blob/0ca824a970a7f994511cb0de07410556b689f1dd/src/HDF5.jl#L939-L960">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Vahana.read_globals" href="#Vahana.read_globals"><code>Vahana.read_globals</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">read_globals(filename::String, T::DataType; [ transition = typemax(Int64), comment = &quot;&quot; ])
read_globals(sim::Simulation, T::DataType; [ transition = typemax(Int64), comment = &quot;&quot; ])
read_globals(sim::Simulation, nr::Int64, T::DataType; [ transition = typemax(Int64), comment = &quot;&quot; ])
read_globals(filename::String; [ transition = typemax(Int64), comment = &quot;&quot; ])</code></pre><p>Read the global values from an HDF5 file. If <code>filename</code> is given, the parameters are read from the file with this filename from the <code>h5</code> subfolder of the current working directory.</p><p>If a simulation <code>sim</code> is given instead, the filename from the <a href="definition.html#Vahana.create_simulation"><code>create_simulation</code></a> call is used.</p><p>If the <code>overwrite_file</code> argument of <a href="definition.html#Vahana.create_simulation"><code>create_simulation</code></a> is set to true, and the file names are supplemented with a number, the number of the meant file can be specified via the <code>nr</code> argument.</p><p>In the case that the DataType <code>T</code> of the argument <code>globals</code> of <a href="definition.html#Vahana.create_simulation"><code>create_simulation</code></a> used for the simulation is specified, the result will be an instance of T, elsewhere it will be a Dict with the fields of the written Globals type as keys.</p><p>Per default, the last written globals are read. The <code>transition</code> keyword allows to read also earlier versions. Alternatively, the comment that was specified when write_snapshot was called can be specified with the <code>comment</code> keyword to read the corresponding snapshot.</p><p>See also <a href="hdf5.html">File storage</a> for details.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/s-fuerst/Vahana.jl/blob/0ca824a970a7f994511cb0de07410556b689f1dd/src/HDF5.jl#L1011-L1040">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Vahana.read_agents!" href="#Vahana.read_agents!"><code>Vahana.read_agents!</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">read_agents!(sim::Simulation, [name::String = sim.filename; transition = typemax(Int64), types::Vector{DataType}, comment = &quot;&quot; ])
read_agents!(sim::Simulation, nr::Int64; [transition = typemax(Int64), types::Vector{DataType}, comment = &quot;&quot; ])</code></pre><p>Read the agents from an HDF5 file into the simulation <code>sim</code>. If <code>name</code> is given, the agent are read from the file with this filename from the <code>h5</code> subfolder of the current working directory, or from the subfolder set with <a href="hdf5.html#Vahana.set_hdf5_path"><code>set_hdf5_path</code></a>. In the other case the filename from the <a href="definition.html#Vahana.create_simulation"><code>create_simulation</code></a> call is used.</p><p>If the <code>overwrite_file</code> argument of <a href="definition.html#Vahana.create_simulation"><code>create_simulation</code></a> is set to true, and the file names are supplemented with a number, the number of the meant file can be specified via the <code>nr</code> argument.</p><p>Per default, the agent states from the last transition function written to the file are read. The <code>transition</code> keyword allows to read also earlier versions. Alternatively, the comment that was specified when write_snapshot was called can be specified with the <code>comment</code> keyword to read the corresponding snapshot.</p><p>If only the agents of a subset of agent types are to be read, this subset can be specified via the optional <code>types</code> argument.</p><p>When the agents from a distributed simulation is read into a single threaded simulation, the IDs of the agents are modified.  <code>read_agents!</code> returns a dictory that contains the ID mapping.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/s-fuerst/Vahana.jl/blob/0ca824a970a7f994511cb0de07410556b689f1dd/src/HDF5.jl#L1167-L1193">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Vahana.read_edges!" href="#Vahana.read_edges!"><code>Vahana.read_edges!</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">read_edges!(sim::Simulation, [name::String = sim.filename; idmapfunc = identity, transition = typemax(Int64), types::Vector{DataType}, comment = &quot;&quot; ])
read_edges!(sim::Simulation, nr::Int64; [ idmapfunc = identity, transition = typemax(Int64), types::Vector{DataType}, comment = &quot;&quot; ])</code></pre><p>Read the edges from an HDF5 file into the simulation <code>sim</code>. If <code>name</code> is given, the edges are read from the file with this filename from the <code>h5</code> subfolder of the current working directory.  In the other case the filename from the <a href="definition.html#Vahana.create_simulation"><code>create_simulation</code></a> call is used.</p><p>If the <code>overwrite_file</code> argument of <a href="definition.html#Vahana.create_simulation"><code>create_simulation</code></a> is set to true, and the file names are supplemented with a number, the number of the meant file can be specified via the <code>nr</code> argument.</p><p>Per default, the edge states from the last transition function written to the file are read. The <code>transition</code> keyword allows to read also earlier versions. Alternatively, the comment that was specified when write_snapshot was called can be specified with the <code>comment</code> keyword to read the corresponding snapshot.</p><p>If only the edges of a subset of edge types are to be read, this subset can be specified via the optional <code>types</code> argument.</p><p>When the edges from a distributed simulation is read into a single threaded simulation, the IDs of the agents are modified.  The <code>idmapfunc</code> must be a function that must return the new agent id for a given old agent id. <a href="hdf5.html#Vahana.read_agents!"><code>read_agents!</code></a> returns a <code>Dict{AgentID, AgentID}</code> that can be used for this via: <code>idmapfunc = (key) -&gt; idmapping[key]</code>, where <code>idmapping</code> is such a <code>Dict</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/s-fuerst/Vahana.jl/blob/0ca824a970a7f994511cb0de07410556b689f1dd/src/HDF5.jl#L1344-L1373">source</a></section></article><p>For e.g. postprocessing it is possible to read the simulation state without defining a model and simulation. Just import Vahana, use <code>set_hdf5_path</code> to determine where the simulations are stored and use:</p><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Vahana.read_agents" href="#Vahana.read_agents"><code>Vahana.read_agents</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">read_agents(filename::String, type; transition = typemax(Int64))</code></pre><p>Read the agentstates of <code>type</code> (which can be a DataType, String or Symbol) from an HDF5 file with the name <code>filename</code>. The agent are read from the <code>h5</code> subfolder of the current working directory, or from the subfolder set with <a href="hdf5.html#Vahana.set_hdf5_path"><code>set_hdf5_path</code></a>.</p><p>Per default, the agent states from the last transition function written to the file are read. The <code>transition</code> keyword allows to read also earlier versions. Alternatively, the comment that was specified when write_snapshot was called can be specified with the <code>comment</code> keyword to read the corresponding snapshot.</p><p>Returns a vector of named tuples that represent the agent states. In parallel simulations, the vector includes only the agent states where the write operation originated from the same rank as the current process. When the current session runs with a single process (size = 1), the agent states from all ranks are consolidated into the returned vector.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/s-fuerst/Vahana.jl/blob/0ca824a970a7f994511cb0de07410556b689f1dd/src/HDF5.jl#L1103-L1123">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Vahana.read_edges" href="#Vahana.read_edges"><code>Vahana.read_edges</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">read_edges(filename::String, type; transition = typemax(Int64), comment = &quot;&quot;)</code></pre><p>Read the edgestates of <code>type</code> (which can be a DataType, String or Symbol) from an HDF5 file with the name <code>filename</code>.  The edgestates are read from the <code>h5</code> subfolder of the current working directory, or from the subfolder set with <a href="hdf5.html#Vahana.set_hdf5_path"><code>set_hdf5_path</code></a>.</p><p>Per default, the edge states from the last transition function written to the file are read. The <code>transition</code> keyword allows to read also earlier versions. Alternatively, the comment that was specified when write_snapshot was called can be specified with the <code>comment</code> keyword to read the corresponding snapshot.</p><p>Returns a vector of edges. In parallel simulations, the vector includes only edges where the write operation originated from the same rank as the current process. When the current session runs with a single process (size = 1), the edges from all ranks are consolidated into the returned vector.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/s-fuerst/Vahana.jl/blob/0ca824a970a7f994511cb0de07410556b689f1dd/src/HDF5.jl#L1286-L1306">source</a></section></article><p>You can also read the parameters and globals of a simulation in the same way using the method implementations of <a href="hdf5.html#Vahana.read_params"><code>read_params</code></a> and <a href="hdf5.html#Vahana.read_globals"><code>read_globals</code></a> without specifing a DataType (this will return Dicts of parameters/globals).</p><h2 id="Transition"><a class="docs-heading-anchor" href="#Transition">Transition</a><a id="Transition-1"></a><a class="docs-heading-anchor-permalink" href="#Transition" title="Permalink"></a></h2><p>All <code>read_*</code> functions have a keyword called transition. If this is not set, the last stored data of a type is always read, but via this keyword it is also possible to read the previous state of the simulation (or a part of it) (assuming it was written multiple times, of course).</p><p>Vahana counts internally how many times the function <a href="transition.html#Vahana.apply!"><code>apply!</code></a> is called (in the current Vahana implementation this is stored in a field called <code>num_transitions</code> of the simulation). When a new dataset is created by a <code>write_*</code> call, this information is stored with the dataset.</p><p>When <code>read_snapshot!</code> is called, Vahana looks for the highest <code>num_transition</code> that is less than or equal to the transition keyword for the types to be read. Since the default value for the argument is typemax(Int64), the newest dataset is read by default.</p><p>For snapshots the <code>list_snapshots</code> function returns a list of all stored snapshots in the file.</p><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Vahana.list_snapshots" href="#Vahana.list_snapshots"><code>Vahana.list_snapshots</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">list_snapshots(name::String)
list_snapshots(sim::Simulation)
list_snapshots(sim::Simulation, nr::Int64)</code></pre><p>List all snapshots of a HDF5 file. If <code>name</code> is given, the snapshots from the file with this filename is returned.  In the other case the filename from the <a href="definition.html#Vahana.create_simulation"><code>create_simulation</code></a> call is used.</p><p>If the <code>overwrite_file</code> argument of <a href="definition.html#Vahana.create_simulation"><code>create_simulation</code></a> is set to true, and the file names are supplemented with a number, the number of the meant file can be specified via the <code>nr</code> argument.</p><p>Returns a vector of tuples, where the first element is the transition number for which a snapshot was saved, and the second element is the comment given in the <a href="hdf5.html#Vahana.write_snapshot"><code>write_snapshot</code></a> call.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/s-fuerst/Vahana.jl/blob/0ca824a970a7f994511cb0de07410556b689f1dd/src/HDF5.jl#L1642-L1658">source</a></section></article><h2 id="Metadata"><a class="docs-heading-anchor" href="#Metadata">Metadata</a><a id="Metadata-1"></a><a class="docs-heading-anchor-permalink" href="#Metadata" title="Permalink"></a></h2><p>It&#39;s possible to attach Metadata to the parameters and globals of a simulation.</p><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Vahana.write_metadata" href="#Vahana.write_metadata"><code>Vahana.write_metadata</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">write_metadata(sim::Simulation, type::Union{Symbol, DataType}, field::Symbol, key::Symbol, value)</code></pre><p>Attach metadata to a <code>field</code> of an agent- or edgetype or the <code>globals</code> or <code>params</code> struct (see <a href="definition.html#Vahana.create_simulation"><code>create_simulation</code></a>) or to a raster (in that case <code>field</code> must be the name of the raster). <code>type</code> must be an agent- or edgetype, or one of these symbols: :Global, :Param or :Raster. Metadata is stored via <code>key, value</code> pairs, so that multiple metadata can be attached to a single field.</p><p>See also: <a href="hdf5.html#Vahana.read_metadata"><code>read_metadata</code></a></p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/s-fuerst/Vahana.jl/blob/0ca824a970a7f994511cb0de07410556b689f1dd/src/HDF5.jl#L1696-L1707">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Vahana.write_sim_metadata" href="#Vahana.write_sim_metadata"><code>Vahana.write_sim_metadata</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">write_sim_metadata(sim::Simulation, key::Symbol, value)</code></pre><p>Attach additional metadata to a simulation. </p><p>See also: <a href="hdf5.html#Vahana.read_sim_metadata"><code>read_sim_metadata</code></a></p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/s-fuerst/Vahana.jl/blob/0ca824a970a7f994511cb0de07410556b689f1dd/src/HDF5.jl#L1857-L1863">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Vahana.read_metadata" href="#Vahana.read_metadata"><code>Vahana.read_metadata</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">read_metadata(sim::Simulation, type::Union{Symbol, DataType}[, field::Symbol, key::Symbol ])
read_metadata(filename::String, type::Union{Symbol, DataType}[, field::Symbol, key::Symbol ])</code></pre><p>Read metadata for a <code>field</code> of an agent- or edgetype or the <code>globals</code> or <code>params</code> struct (see <a href="definition.html#Vahana.create_simulation"><code>create_simulation</code></a>) or to a raster (in that case <code>field</code> must be the name of the raster). <code>type</code> must be an agent- or edgetype, or one of these symbols: :Global, :Param or :Raster. Metadata is stored via <code>key, value</code> pairs. Multiple pairs can be attached to a single field, a single piece of the metadata can be retrived via the <code>key</code> parameter. If this is not set (or set to Symbol()), a Dict{Symbol, Any} with the complete metadata of this field is returned. If also <code>field</code> is not set, the metadata of all fields are returned.</p><p>See also: <a href="hdf5.html#Vahana.write_metadata"><code>write_metadata</code></a></p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/s-fuerst/Vahana.jl/blob/0ca824a970a7f994511cb0de07410556b689f1dd/src/HDF5.jl#L1752-L1768">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Vahana.read_sim_metadata" href="#Vahana.read_sim_metadata"><code>Vahana.read_sim_metadata</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">read_sim_metadata(sim::Simulation, [ key::Symbol = Symbol() ])
read_sim_metadata(filename::String, [ key::Symbol = Symbol() ])</code></pre><p>Read metadata for a simulation or from the file <code>filename</code>. Metadata is stored via <code>key</code>, value pairs. If <code>key</code> is not set (or set to Symbol()), a Dict{Symbol, Any} with the complete metadata of the simulation is returned.</p><p>The following metadata is stored automatically:</p><ul><li>simulation_name</li><li>model_name</li><li>date (in the format &quot;yyyy-mm-dd hh:mm:ss&quot;)</li></ul><p>See also: <a href="hdf5.html#Vahana.write_metadata"><code>write_metadata</code></a></p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/s-fuerst/Vahana.jl/blob/0ca824a970a7f994511cb0de07410556b689f1dd/src/HDF5.jl#L1878-L1893">source</a></section></article><h2 id="Restrictions-and-Workarounds"><a class="docs-heading-anchor" href="#Restrictions-and-Workarounds">Restrictions and Workarounds</a><a id="Restrictions-and-Workarounds-1"></a><a class="docs-heading-anchor-permalink" href="#Restrictions-and-Workarounds" title="Permalink"></a></h2><p>The exact datastructs that can be stored and read from a HDF5 depends in the HDF5.jl implementation. E.g. before v0.16.15 Tuples where not supported. </p><p>The following functions are workarounds for two current restrictions.</p><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Vahana.create_enum_converter" href="#Vahana.create_enum_converter"><code>Vahana.create_enum_converter</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">create_enum_converter()</code></pre><p>The HDF5.jl library does not support Enums as fields of structs that should be stored. This function add this support but as this involves type piracy, this support must be enabled explicitly.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/s-fuerst/Vahana.jl/blob/0ca824a970a7f994511cb0de07410556b689f1dd/src/HDF5.jl#L21-L27">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Vahana.create_namedtuple_converter" href="#Vahana.create_namedtuple_converter"><code>Vahana.create_namedtuple_converter</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">create_namedtuple_converter(T::DataType)</code></pre><p>The HDF5.jl library does not support the storage of nested structs, but structs can have <code>NamedTuples</code> as fields. This function creates a convert function from a struct to a corresponding <code>NamedTuple</code> (and also the other way around), so after calling this for a type <code>T</code>, <code>T</code> can be the type of an agent/edge/param/global field.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/s-fuerst/Vahana.jl/blob/0ca824a970a7f994511cb0de07410556b689f1dd/src/HDF5.jl#L1681-L1689">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Vahana.create_string_converter" href="#Vahana.create_string_converter"><code>Vahana.create_string_converter</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">create_string_converter(add_show_method::Bool = true)</code></pre><p>The HDF5.jl library (version 0.17.2) does not support <code>InlineStrings</code> or <code>StaticStrings</code> in structs. Standard <code>String</code>s are also not suitable for agent and edge types, as these must be bits types.</p><p>Also, parallel HDF5 does not support <code>String</code>s for parameters or globals. </p><p>To address this limitation, <code>create_string_converter</code> generates conversion methods between <code>String</code> and <code>SVector{N, UInt8}</code> instances (from the <code>StaticArrays</code> package).  Here, N represents the maximum number of bytes that can be stored, which for Unicode strings may exceed the character count due to variable-length encoding.</p><p>Instead of <code>SVector{N, UInt8}</code> also <code>VString{N}</code> can be used.</p><p>For example, you could create a Person struct with a fixed-size name field:</p><pre><code class="language-julia hljs">struct Foo
    foo::VString{20}
end</code></pre><p>You can then construct a <code>Foo</code> instance using a regular string: <code>Foo(&quot;abc&quot;)</code>.</p><p>If <code>add_show_method</code> is set to <code>true</code> (the default), <code>show</code> methods are also defined for these <code>SVector</code>s. To avoid confusion while working with Julia&#39;s REPL, where the value might appear as a <code>String</code> while actually being an <code>SVector</code>, the output includes &quot;(as UInt8-Vector)&quot; after the value itself.</p><p>When <code>add_show_method</code> is set to <code>true</code> (which is the default behavior), <code>show</code> methods are automatically defined for the <code>SVector</code> types. To prevent potential confusion arising from the display of <code>SVector</code> values as <code>String</code>s, the output is formatted to include the annotation &quot;::UInt8[]&quot; following the value itself. </p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/s-fuerst/Vahana.jl/blob/0ca824a970a7f994511cb0de07410556b689f1dd/src/HDF5.jl#L37-L76">source</a></section></article><h2 id="Example-Model"><a class="docs-heading-anchor" href="#Example-Model">Example Model</a><a id="Example-Model-1"></a><a class="docs-heading-anchor-permalink" href="#Example-Model" title="Permalink"></a></h2><p>The tutorials in the documentation does not include examples for the file storage functionality, but this <a href="https://git.zib.de/sfuerst/vahana-episim/">model</a> is a good example, which also demonstrates checkpointing (resuming a simulation after an interruption), and working with initial snapshots (the initialized simulation state is stored after the graph structure is constructed and distributed to the different processes).</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="plots.html">« Plots</a><a class="docs-footer-nextpage" href="logging.html">Logging »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.8.1 on <span class="colophon-date" title="Tuesday 17 June 2025 12:03">Tuesday 17 June 2025</span>. Using Julia version 1.11.5.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
