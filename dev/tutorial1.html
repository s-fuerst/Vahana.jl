<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Tutorial · Vahana Documentation</title><script data-outdated-warner src="assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="assets/documenter.js"></script><script src="siteinfo.js"></script><script src="../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="index.html">Vahana Documentation</a></span></div><form class="docs-search" action="search.html"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="index.html">Introduction</a></li><li><span class="tocitem">Tutorials</span><ul><li class="is-active"><a class="tocitem" href="tutorial1.html">Tutorial</a><ul class="internal"><li class="toplevel"><a class="tocitem" href="#Goal"><span>Goal</span></a></li><li class="toplevel"><a class="tocitem" href="#Model-Background"><span>Model Background</span></a></li><li class="toplevel"><a class="tocitem" href="#Initialization"><span>Initialization</span></a></li><li class="toplevel"><a class="tocitem" href="#Transition-functions"><span>Transition functions</span></a></li><li><a class="tocitem" href="#calc_demand"><span><code>calc_demand</code></span></a></li><li><a class="tocitem" href="#calc_price"><span><code>calc_price</code></span></a></li><li><a class="tocitem" href="#applying-the-transition-functions"><span>applying the transition functions</span></a></li><li class="toplevel"><a class="tocitem" href="#Globals"><span>Globals</span></a></li><li class="toplevel"><a class="tocitem" href="#Finish-the-simulation"><span>Finish the simulation</span></a></li></ul></li><li><a class="tocitem" href="hegselmann.html">Opinion Model</a></li><li><a class="tocitem" href="predator.html">Predator / Prey</a></li></ul></li><li><a class="tocitem" href="performance.html">Performance Tuning</a></li><li><span class="tocitem">API</span><ul><li><a class="tocitem" href="definition.html">Model Definition</a></li><li><a class="tocitem" href="initialization.html">Initialization</a></li><li><a class="tocitem" href="transition.html">Transition Function</a></li><li><a class="tocitem" href="global.html">Global Layer</a></li><li><a class="tocitem" href="plots.html">Plots</a></li><li><a class="tocitem" href="hdf5.html">HDF5</a></li><li><a class="tocitem" href="logging.html">Logging</a></li><li><a class="tocitem" href="config.html">Configuration</a></li><li><a class="tocitem" href="misc.html">Misc</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Tutorials</a></li><li class="is-active"><a href="tutorial1.html">Tutorial</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href="tutorial1.html">Tutorial</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/s-fuerst/Vahana.jl/blob/main/docs/examples/tutorial1.jl" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Tutorial"><a class="docs-heading-anchor" href="#Tutorial">Tutorial</a><a id="Tutorial-1"></a><a class="docs-heading-anchor-permalink" href="#Tutorial" title="Permalink"></a></h1><h1 id="Goal"><a class="docs-heading-anchor" href="#Goal">Goal</a><a id="Goal-1"></a><a class="docs-heading-anchor-permalink" href="#Goal" title="Permalink"></a></h1><p>In this tutorial, we will build a model with multiple buyers and sellers, whereby the buyers will always randomly choice a seller from a fixed subset of the sellers. This subset is of course different for each buyer.</p><p>We use this model to give a first introduction to Vahana, focusing on the core elements but already working with different types of agents and edges between them.</p><h1 id="Model-Background"><a class="docs-heading-anchor" href="#Model-Background">Model Background</a><a id="Model-Background-1"></a><a class="docs-heading-anchor-permalink" href="#Model-Background" title="Permalink"></a></h1><p>We have a simple but volatile market with <span>$n$</span> buyers, <span>$m$</span> sellers, and two goods called <span>$x$</span> and <span>$y$</span>. Each seller sells both commodities, buyers buy both commodities from a single seller, but at each step the buyer randomly selects a seller from a fixed subset of all sellers. We are only interested in relative prices, so the price for good <span>$x$</span> is set to 1, the price for good <span>$y$</span> is <span>$p$</span>.</p><p>At each step, each buyer has a constant fixed budget <span>$B$</span> for buying the commodities. The quantities are choosen using a Cobb-Douglas utility function:</p><p class="math-container">\[\begin{aligned}
\max_{x,y} u(x, y) &amp;= x^\alpha \cdot y^{1 - \alpha} \\
\textrm{s.t.:} &amp; x + y \cdot p \leq B
\end{aligned}\]</p><p>The solution of this optimization is:</p><p class="math-container">\[\begin{aligned}
x &amp;= B \cdot \alpha \\
y &amp;= \frac{B \cdot (1 - \alpha)}{p}
\end{aligned}\]</p><p>For illustrative reasons, we neglect production except for the assumption that <span>$x$</span> and <span>$y$</span> are joint products, so that the seller tries to find a price where <span>$x = y$</span>. In the case of a single buyer, the solution is <span>$p = \frac{1 - \alpha}{\alpha}$</span>.  But in our case, the sellers are facing different buyers with different preferences <span>$\alpha$</span> and a different budget <span>$B$</span>. So they start with a random price and adjust that price at each time step:</p><p class="math-container">\[\begin{aligned}
p_t &amp;= \frac{d_y}{d_x} \cdot p_{t-1} \\
\textrm{where } d_x &amp;= \sum_{b \in \textrm{buyers}}x_b ,\quad d_y = \sum_{b \in \textrm{buyers}} y_b
\end{aligned}\]</p><p>It&#39;s easy to see that in the single buyer case, this will lead to <span>$p = \frac{1 - \alpha}{\alpha}$</span> after a single step.</p><h1 id="Initialization"><a class="docs-heading-anchor" href="#Initialization">Initialization</a><a id="Initialization-1"></a><a class="docs-heading-anchor-permalink" href="#Initialization" title="Permalink"></a></h1><p>In addition to the Vahana package, we also need the Random package to initialize the buyer with different random values for B and <span>$\alpha$</span> and to select a seller from the list of known sellers.</p><pre><code class="language-julia hljs">using Vahana
using Random</code></pre><p>We have two types of agents, <code>Buyer</code> and <code>Seller</code>. In Vahana, agents are defined as (immutable) structs. The structs define the state of the various agent types. All the types defined for the Model must be &quot;plain data&quot; types. Such a type is call isbitstype in Julia, and must fulfill the following contrains: A bitstype is immutable and contains no references to other values, only primitive types and other isbitstype types. This also implies that the type of a struct variables must be declared.</p><p>Since we want to calculate the average price of <span>$y$</span> later, the seller needs to store the quantity of the sold good <span>$y$</span>. So we have:</p><pre><code class="language-julia hljs">struct Buyer
    α::Float64
    B::Float64
end

struct Seller
    p::Float64
    d_y::Float64 # the sum of bought goods y (for a single time step)
end</code></pre><p>We also write constructors for these agents. For the Buyer we want for <span>$\alpha$</span> a random value between zero and one, and for B a random integer betwenn 1 and 100. The initial price <span>$p$</span> of a seller should be between 0.5 and 1.5.</p><pre><code class="language-julia hljs">Buyer() = Buyer(rand(), rand((1:100)))

Seller() = Seller(rand() + 0.5, 0);</code></pre><p>And we have also two types of networks. The first is fixed and describes the sellers known to a single buyer. Since the direction of an edge determines the flow of information and the buyer needs the price information to calculate his demand, it is a network from sellers to buyers. We call this network <code>KnownSeller</code>.</p><p>As for the agents we must define a struct for each type of network. The edges of the <code>KnownSeller</code> network do not carry additional information, so we define them just as a struct without any field, and will use them as a kind of a tag later to select only the edges of this type.</p><pre><code class="language-julia hljs">struct KnownSellers end</code></pre><p>As you can see, this type does not contain any information about the source or target agent of the edge (we have always directed edges in Vahana). Vahana declares the parametric type</p><p>struct Edge{T}     from::AgentID     state::T end</p><p>where T is in our case the KnownSeller. <code>from</code> is the agent on the source of the edge, but the target of the edge is missing. The edges are stored in containers like a Dict{AgentID, Vector{Edge{T}}} (the concrete container depends on so called hints, see <a href="performance.html#Edge-Hints">Edge Hints</a>, where the keys are the target agents, so adding the target also to the Edge struct is redundant and would only consume memory and CPU cycles unnecessarily.</p><p>We continue now with the second network <code>Bought</code> that will be constructed in the transition function called <code>calc_demand</code> which will be the implementation of equation (\ref{eqn:demand}). This network describes from which seller a buyer bought something, so it edge will go from the buyers to the sellers. And those edges come with additional state, which provides the quantity of the bought goods:</p><pre><code class="language-julia hljs">struct Bought
    x::Float64
    y::Float64
end</code></pre><p>Sometimes we want to add these quantities, so we define a + operator for this structure</p><pre><code class="language-julia hljs">import Base.+
+(a::Bought, b::Bought) = Bought(a.x + b.x, a.y + b.y);</code></pre><p>Before we can construct our simulation, we need to define two additional structures. The first structure contains the parameters of the simulation.</p><pre><code class="language-julia hljs">Base.@kwdef struct Params
    numBuyer::Int64
    numSeller::Int64
    knownSellers::Int64
end;</code></pre><p>We use the <code>@kwdef</code> macro here only for code readability reasons, as this allows us to use the name of the parameters in the <code>Params</code> constructor.</p><p>The second struct allows us to add a global state to the simulation, which can be an exogenous input or an (aggregated) state from the simulation itself. This global state can then be used for the agents&#39; decisions or, as in our case, as the output of the simulation, namely the development of the average price and excess demand.</p><pre><code class="language-julia hljs">mutable struct Globals
    x_minus_y::Vector{Float64}
    p::Vector{Float64}
end</code></pre><p>We now have all the elements needed to construct an uninitialized simulation. Therefore we combine first all the Agent- and Edgetypes into a <code>ModelTypes</code> collection, via the <code>register_agenttype!</code> and <code>register_edgetype!</code> functions, and then call <code>contruct_model</code> on this collection.</p><pre><code class="language-julia hljs">const model = ModelTypes() |&gt;
    register_agenttype!(Buyer) |&gt;
    register_agenttype!(Seller) |&gt;
    register_edgetype!(KnownSellers) |&gt;
    register_edgetype!(Bought) |&gt;
    create_model(&quot;Excess Demand&quot;);</code></pre><p><code>create_model</code> returns a blueprint for our simulation. Simulations itself can be seen as instances of models, where each simulation has it&#39;s individual state and set of parameters. The Simulation is instanciated by the <code>create_simulation</code> function, which needs beside the model also the parameters struct and the globals struct, whereby the parameters and globals can be also <code>nothing</code>.</p><pre><code class="language-julia hljs">const sim = create_simulation(model,
                              Params(numBuyer = 50,
                                     numSeller = 5,
                                     knownSellers = 2),
                              Globals(Vector(),
                                      Vector()))</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">
Simulation Name: Excess Demand
Parameter(s):
	 :numBuyer : 50
	 :numSeller : 5
	 :knownSellers : 2
Agent(s):
	 Type Buyer with 0 agent(s)
	 Type Seller with 0 agent(s)
Edge(s):
	 Type KnownSellers with 0 edge(s) for 0 agent(s)
	 Type Bought with 0 edge(s) for 0 agent(s)
Global(s):
	 :x_minus_y (empty) 
	 :p (empty) 
Still in initialization process!.</code></pre><p>Now we can also populate our simulation with the agents and the <code>KnownSeller</code> network (the <code>Bought</code> network is a result of the <code>calc_demand</code> transition, and therefore no edges are added in the initialization phase).</p><p>Vahana therefore has the functions <code>add_agent!</code> or <code>add_agents!</code>, where <code>add_agents</code> can be used to add multiple agents at once. These functions return ID(s) of the agent(s), which can be used to create edges between agents. Do not use the IDs for other purposes, they are not guaranteed to be stable, e.g. the ID of an agent may change in the <a href="initialization.html#Vahana.finish_init!"><code>finish_init!</code></a> call. in a parallel simulation <code>finish_init!</code> may &quot;moved&quot; to another (MPI) rank, and as the ID contains Vahana internal information like the rank, the agent will have a different ID afterwards. It is also possible that the same ID is used twice for different agents. So an ID returned by a call to a Vahana function or passed as an argument to callback function (see <a href="performance.html#Transition functions">Transition functions</a> below) can only be used until finish_init! is called or the callback/transition function is finished. In the case that you need a stable ID, you need to add such an ID to the agent state and create these IDs by yourself (e.g. using the UUIDs functions).</p><p>In our case, we use the IDs returned by add_agents! to iterate over all buyer IDs, randomly select <code>numSellers</code> seller IDs for each buyer ID, and then create edges between them in the <code>KnownSellers</code> network.</p><p>We can see in the following code fragment also how parameters of the Simulation can be accessed via the <code>param</code> function.</p><pre><code class="language-julia hljs">buyerids = add_agents!(sim, [ Buyer() for _ in 1:param(sim, :numBuyer)])

sellerids = add_agents!(sim, [ Seller() for _ in 1:param(sim, :numSeller)])

for b in buyerids
    for s in rand(sellerids, param(sim, :knownSellers))
        add_edge!(sim, s, b, KnownSellers())
    end
end

sim</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">
Simulation Name: Excess Demand
Parameter(s):
	 :numBuyer : 50
	 :numSeller : 5
	 :knownSellers : 2
Agent(s):
	 Type Buyer with 50 agent(s)
	 Type Seller with 5 agent(s)
Edge(s):
	 Type KnownSellers with 100 edge(s) for 50 agent(s)
	 Type Bought with 0 edge(s) for 0 agent(s)
Global(s):
	 :x_minus_y (empty) 
	 :p (empty) 
Still in initialization process!.</code></pre><p>As you can see from the result of the code block above, Vahana has a &quot;pretty print&quot; function for some of its data structures.</p><p>To complete the initialization it is necessary to call <code>finish_init!</code>. In the later MPI version this will be used e.g. to distribute the graph to the different processes. The function also sets all containers to a read-only state, which is why the (R/W) part is now omitted in the output.</p><pre><code class="language-julia hljs">finish_init!(sim)</code></pre><h1 id="Transition-functions"><a class="docs-heading-anchor" href="#Transition-functions">Transition functions</a><a id="Transition-functions-1"></a><a class="docs-heading-anchor-permalink" href="#Transition-functions" title="Permalink"></a></h1><p>We have now a simulation with an initial state. To modify the state we need to define transition functions. Those functions have the signature <code>transition_function(agent::T, id::AgentID, sim::Simulation)</code>.</p><p>The argument <code>agent</code> contains the state of a single agent of the type <code>T</code>. The argument <code>id</code> contains the id of this agent, as the id is not part of the agent state itself, and maybe needed for constructing new edges.</p><h2 id="calc_demand"><a class="docs-heading-anchor" href="#calc_demand"><code>calc_demand</code></a><a id="calc_demand-1"></a><a class="docs-heading-anchor-permalink" href="#calc_demand" title="Permalink"></a></h2><p>The first transition function we are implementing calculates the demand for the goods <span>$x$</span> and <span>$y$</span> as shown in equation (\ref{eqn:demand}).</p><p>This transition function is called for all Buyers. First the <code>edge_to</code> function is used to get a <code>Vector</code> that cotains all the sellers known by <code>b</code>. It&#39;s important to call <code>edges</code> only for <code>id</code>, and not e.g. to <code>from</code> IDs of edges derived by <code>edges</code>.</p><p>One of the available edges to a sellers is selected using the <code>rand</code> function. For this seller the state is accessed via the <code>agentstate</code> function. In the case that the type of the agent from which we want to access the state is unknown, it&#39;s possible to use the <code>agentstate_flexible</code> instead.</p><p>Then the agent calculates it&#39;s demand for the goods <span>$x$</span> and <span>$y$</span>, and adds an edge with the information about the demand to the <code>Bought</code> network, which is then used in the next transition function by the sellers to sum up the demand and calculate the new price.</p><pre><code class="language-julia hljs">function calc_demand(b::Buyer, id, sim)
    seller = rand(neighborids(sim, id, KnownSellers))
    s = agentstate(sim, seller, Seller)
    x = b.B * b.α
    y = b.B * (1 - b.α) / s.p
    add_edge!(sim, id, seller, Bought(x, y))
end;</code></pre><h2 id="calc_price"><a class="docs-heading-anchor" href="#calc_price"><code>calc_price</code></a><a id="calc_price-1"></a><a class="docs-heading-anchor-permalink" href="#calc_price" title="Permalink"></a></h2><p>In the <code>calc_price</code> transition function the sellers summarise all the goods <span>$x$</span> and <span>$y$</span> they sold. Therefore they first get all the Bought edges that are pointing to them via the <code>network(sim, Bought)</code>.</p><p>In the case that a seller did not sold anything, and therefore no edge exists with the seller as target, <a href="transition.html#Vahana.edgestates"><code>edgestates</code></a> returns <code>nothing</code> and the seller does not change its state. Otherwise the <code>edgestates</code> function returns a Vector that contains the states of all the edges. We can aggregate this vector with the reduce function (remember that we have defined the + operator for Bought above).</p><p>Then we construct a new seller. <code>q.y / q.x * s.p</code> is thereby the new price as shown in equation (\ref{eqn:price}).</p><pre><code class="language-julia hljs">function calc_price(s::Seller, id, sim)
    sold = edgestates(sim, id, Bought)
    if isnothing(sold)
        return s
    end
    q = reduce(+, sold)
    Seller(q.y / q.x * s.p, q.y)
end;</code></pre><h2 id="applying-the-transition-functions"><a class="docs-heading-anchor" href="#applying-the-transition-functions">applying the transition functions</a><a id="applying-the-transition-functions-1"></a><a class="docs-heading-anchor-permalink" href="#applying-the-transition-functions" title="Permalink"></a></h2><p>To apply our defined transistion functions to the simulation, Vahana provides the <code>apply!</code> function with the signature <code>apply!(sim, f::Function, call, read, write; add_existing)</code>.</p><p><code>f</code> is in our case one of the transition functions we have already defined above. <code>call</code> is a collection of agent types. In most cases (like here) this collection will only contain a single type, but in general it&#39;s possible to define a transition function for multiple agent types (e.g. just define also <code>calc_demand(s::Seller, ...))</code> in the case that sellers could also bought goods from other sellers, and add <code>Seller</code> to the <code>call</code> collection).</p><p>The <code>read</code> collection must contain all agent and edge state types that are accessed in the transition function. Among other things, this transmit in a parallel run the agents and edges to all processes that need to access them. If the Vahana assertion system is active, it checks that only these types are accessed, but if it is disabled via <a href="config.html#Vahana.enable_asserts"><code>enable_asserts</code></a>, forgetting to add types to <code>read</code> can lead to incorrect results. Having more types than necessary in the <code>read</code> collection, on the other hand, only leads to worse performance.</p><p>In the case that the <code>call</code> type is not in <code>read</code> (we do not have this case in this tutorial), the first argument of the transition function is no longer the agent state, and instead the type of the first argument is a Value Type of this <code>call</code> type.</p><p>The <code>write</code> collection must contain all agent and edge state types that are changed in the transition function. In the purest conceptional form (and the first prototypes), the resulting graph of a transition function is the union of the returned agents and edges of all transition function calls, but of course this causes a lot of overhead since stable parts of the graph must also be reconstructed. Instead of this radical behaviour, Vahana removes <code>only</code> the part of the graph that are part of the <code>write</code> collection. Which also implies, that you can only change the state of agents/edges of a types when you readding also the state of constant elements of that type. In the case that you want e.g. additional edges without changing the existing one, you can use the optional keyword <code>add_existing</code>, which is aslo a collection of agent or edge state types. For all types in the collection the existing agents/edges will not be removed even when the type is also in the <code>write</code> collection.</p><p>This may sound complicated, but in practice the procedure is actually quite straightforward. Write your transition function as we did above, then check what types of agents the transition function should be called for and add those types to <code>call</code>. Then check which types appear in function calls like <a href="transition.html#Vahana.edgestates"><code>edgestates</code></a> and add them to <code>read</code>. Are you accessing the first argument of the transition function (the state of the agent itself)? Then add that type to <code>read</code> as well. Do you want to return a changed state of the agent. Then add that type to <code>write</code>. Do you have additional <a href="initialization.html#Vahana.add_edge!"><code>add_edge!</code></a> or <a href="initialization.html#Vahana.add_agent!"><code>add_agent!</code></a> calls. Then add their type to <code>write</code> as well. And note that all current agents/edges will be removed from the simulation as long as their type is not also in <code>add_existing</code>.</p><p>Following this schema we get for our transition functions</p><pre><code class="language-julia hljs">sim2 = apply(sim, calc_demand, Buyer, [ Buyer, Seller, KnownSellers ], Bought);</code></pre><p>and</p><pre><code class="language-julia hljs">sim3 = apply(sim2, calc_price, Seller, [ Seller, Bought ], Seller);</code></pre><p>We used here a version of the <code>apply</code> which returns a copy of the simulation instead of changing the simulation inplace. This can be usefull while implementing the model in the REPL, as the transition does not destroy the original state, but should not be used in production, here always the <code>apply!</code> should be used.</p><p>But here we can now simply compare the simulation states before and after calling the transition functions:</p><pre><code class="language-julia hljs">all_agents(sim, Seller)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">5-element Vector{Seller}:
 Seller(0.8914703659708869, 0.0)
 Seller(1.178627162508529, 0.0)
 Seller(1.109750051063541, 0.0)
 Seller(0.6871767637470297, 0.0)
 Seller(0.6362329932869548, 0.0)</code></pre><p>and</p><pre><code class="language-julia hljs">all_agents(sim3, Seller)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">5-element Vector{Seller}:
 Seller(0.6766145462928457, 150.29317984330262)
 Seller(1.189189922059813, 248.8771897001866)
 Seller(1.0526506359074712, 331.79397051946574)
 Seller(0.7618985495781027, 293.8763678262163)
 Seller(1.6538921134536804, 447.6348863260403)</code></pre><h1 id="Globals"><a class="docs-heading-anchor" href="#Globals">Globals</a><a id="Globals-1"></a><a class="docs-heading-anchor-permalink" href="#Globals" title="Permalink"></a></h1><p>However, our goal was to obtain a time series for the average price and the excess demand. Vahana does not allow direct access to agent state, but follows the MapReduce pattern from functional programming. The Map part allows mapping an agent or edge state to a new value, and the Reduce part describes how the new values should be combined into a single value.</p><p>E.g. to calculate the excess demand we write</p><pre><code class="language-julia hljs">mapreduce(sim2, b -&gt; b.x - b.y, +, Bought)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">-240.74439690046248</code></pre><p>where the second argument specifies for which agent or edge type the aggregation should be performed, and the anonymous function in the third place describes the assignment for each instance of that type. In our case, the function gets an edge of type <code>Bought</code> and calculates how much more of good x was bought. And this is then added for all edges.</p><p>To calculate the average price we define a helper function</p><pre><code class="language-julia hljs">function calc_average_price(sim)
    m = mapreduce(sim, s -&gt; s.p * s.d_y, +, Seller)
    q = mapreduce(sim, s -&gt; s.d_y, +, Seller)
    m / q
end

calc_average_price(sim3)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">1.1620971681270167</code></pre><p>And now we have all elements to run the simulation, e.g. for 100 steps:</p><pre><code class="language-julia hljs">for _ in 1:100
    apply!(sim, calc_demand, Buyer, [ Buyer, Seller, KnownSellers ], Bought)
    push_global!(sim, :x_minus_y, mapreduce(sim, b -&gt; b.x - b.y, +, Bought))
    apply!(sim, calc_price, Seller, [ Seller, Bought ], Seller)
    push_global!(sim, :p, calc_average_price(sim))
end</code></pre><p>To get the resulting timeseries, we use the <code>getglobal</code> function:</p><pre><code class="language-julia hljs">get_global(sim, :p)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">100-element Vector{Float64}:
 1.0666326873349843
 1.0634148700186667
 1.0908195532299567
 1.091374500613633
 1.059723837318109
 1.0824272522646268
 1.0335296404277223
 1.0777911787147367
 1.0732327180084271
 1.1435775883577877
 ⋮
 1.1725202363379728
 1.1707700345927168
 1.1669543742581443
 1.0238904509319684
 1.0504798702176297
 1.0681438338777325
 1.1248155972090716
 1.229396889829005
 1.1057673080582302</code></pre><p>and</p><pre><code class="language-julia hljs">get_global(sim, :x_minus_y)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">100-element Vector{Float64}:
 -236.9346312632883
   -1.404587779980222
   43.00996669128081
  -31.731211423033212
 -135.70786101725062
 -107.73770741341686
  -22.25338126721734
   -1.2532442017632022
 -100.05615841327179
  -64.74128057178794
    ⋮
  -59.965665860079056
  -81.16282203375874
   38.29612366398816
  -63.99882608423696
    2.559891480388359
  -52.46294851923443
  -95.67592675277727
 -231.77533294462637
 -188.05892168707143</code></pre><p>Or we can convert the globals to a DataFrame. Therefore we must first import the DataFrames package, and can then call a DataFrame constructor</p><pre><code class="language-julia hljs">import DataFrames

DataFrame(sim, Globals)</code></pre><div><div style = "float: left;"><span>100×2 DataFrame</span></div><div style = "clear: both;"></div></div><div class = "data-frame" style = "overflow-x: scroll;"><table class = "data-frame" style = "margin-bottom: 6px;"><thead><tr class = "header"><th class = "rowNumber" style = "font-weight: bold; text-align: right;">Row</th><th style = "text-align: left;">x_minus_y</th><th style = "text-align: left;">p</th></tr><tr class = "subheader headerLastRow"><th class = "rowNumber" style = "font-weight: bold; text-align: right;"></th><th title = "Float64" style = "text-align: left;">Float64</th><th title = "Float64" style = "text-align: left;">Float64</th></tr></thead><tbody><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">1</td><td style = "text-align: right;">-236.935</td><td style = "text-align: right;">1.06663</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">2</td><td style = "text-align: right;">-1.40459</td><td style = "text-align: right;">1.06341</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">3</td><td style = "text-align: right;">43.01</td><td style = "text-align: right;">1.09082</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">4</td><td style = "text-align: right;">-31.7312</td><td style = "text-align: right;">1.09137</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">5</td><td style = "text-align: right;">-135.708</td><td style = "text-align: right;">1.05972</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">6</td><td style = "text-align: right;">-107.738</td><td style = "text-align: right;">1.08243</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">7</td><td style = "text-align: right;">-22.2534</td><td style = "text-align: right;">1.03353</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">8</td><td style = "text-align: right;">-1.25324</td><td style = "text-align: right;">1.07779</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">9</td><td style = "text-align: right;">-100.056</td><td style = "text-align: right;">1.07323</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">10</td><td style = "text-align: right;">-64.7413</td><td style = "text-align: right;">1.14358</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">11</td><td style = "text-align: right;">-9.61267</td><td style = "text-align: right;">1.16787</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">12</td><td style = "text-align: right;">-100.51</td><td style = "text-align: right;">1.04134</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">13</td><td style = "text-align: right;">-78.3911</td><td style = "text-align: right;">1.10216</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">14</td><td style = "text-align: right;">23.1813</td><td style = "text-align: right;">1.179</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">15</td><td style = "text-align: right;">-78.9438</td><td style = "text-align: right;">1.07298</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">16</td><td style = "text-align: right;">-41.0591</td><td style = "text-align: right;">1.11504</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">17</td><td style = "text-align: right;">-35.8235</td><td style = "text-align: right;">1.21014</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">18</td><td style = "text-align: right;">44.0339</td><td style = "text-align: right;">1.11162</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">19</td><td style = "text-align: right;">-42.2211</td><td style = "text-align: right;">1.13641</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">20</td><td style = "text-align: right;">-0.893044</td><td style = "text-align: right;">1.10746</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">21</td><td style = "text-align: right;">-288.582</td><td style = "text-align: right;">1.15889</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">22</td><td style = "text-align: right;">-134.483</td><td style = "text-align: right;">1.05836</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">23</td><td style = "text-align: right;">45.4191</td><td style = "text-align: right;">1.06852</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">24</td><td style = "text-align: right;">23.1026</td><td style = "text-align: right;">1.16652</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">25</td><td style = "text-align: right;">57.5879</td><td style = "text-align: right;">1.3157</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">26</td><td style = "text-align: right;">25.7218</td><td style = "text-align: right;">1.00835</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">27</td><td style = "text-align: right;">-33.2196</td><td style = "text-align: right;">1.112</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">28</td><td style = "text-align: right;">20.5035</td><td style = "text-align: right;">1.10044</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">29</td><td style = "text-align: right;">-81.9143</td><td style = "text-align: right;">1.46311</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">30</td><td style = "text-align: right;">11.9189</td><td style = "text-align: right;">1.12257</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">31</td><td style = "text-align: right;">-214.549</td><td style = "text-align: right;">1.12975</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">32</td><td style = "text-align: right;">-14.3867</td><td style = "text-align: right;">1.06362</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">33</td><td style = "text-align: right;">-100.319</td><td style = "text-align: right;">1.0922</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">34</td><td style = "text-align: right;">10.7828</td><td style = "text-align: right;">1.0422</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">35</td><td style = "text-align: right;">-35.2633</td><td style = "text-align: right;">1.1072</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">36</td><td style = "text-align: right;">-39.1671</td><td style = "text-align: right;">1.04221</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">37</td><td style = "text-align: right;">-102.793</td><td style = "text-align: right;">1.16083</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">38</td><td style = "text-align: right;">-81.9512</td><td style = "text-align: right;">1.15595</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">39</td><td style = "text-align: right;">-20.9839</td><td style = "text-align: right;">1.05047</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">40</td><td style = "text-align: right;">-126.482</td><td style = "text-align: right;">1.07613</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">41</td><td style = "text-align: right;">-0.584371</td><td style = "text-align: right;">1.13319</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">42</td><td style = "text-align: right;">-106.674</td><td style = "text-align: right;">1.12714</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">43</td><td style = "text-align: right;">-11.502</td><td style = "text-align: right;">1.24945</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">44</td><td style = "text-align: right;">-161.847</td><td style = "text-align: right;">1.08979</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">45</td><td style = "text-align: right;">-64.9084</td><td style = "text-align: right;">1.1139</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">46</td><td style = "text-align: right;">-153.031</td><td style = "text-align: right;">1.06086</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">47</td><td style = "text-align: right;">48.5915</td><td style = "text-align: right;">1.07634</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">48</td><td style = "text-align: right;">2.87431</td><td style = "text-align: right;">1.13315</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">49</td><td style = "text-align: right;">-109.55</td><td style = "text-align: right;">1.19539</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">50</td><td style = "text-align: right;">-7.18984</td><td style = "text-align: right;">1.27647</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">51</td><td style = "text-align: right;">-39.4355</td><td style = "text-align: right;">1.04504</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">52</td><td style = "text-align: right;">-68.146</td><td style = "text-align: right;">1.11411</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">53</td><td style = "text-align: right;">-111.241</td><td style = "text-align: right;">1.08697</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">54</td><td style = "text-align: right;">13.3071</td><td style = "text-align: right;">1.13593</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">55</td><td style = "text-align: right;">-120.727</td><td style = "text-align: right;">1.28588</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">56</td><td style = "text-align: right;">-66.1892</td><td style = "text-align: right;">1.21747</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">57</td><td style = "text-align: right;">14.48</td><td style = "text-align: right;">1.03735</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">58</td><td style = "text-align: right;">-67.4933</td><td style = "text-align: right;">1.19564</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">59</td><td style = "text-align: right;">-38.6737</td><td style = "text-align: right;">1.25667</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">60</td><td style = "text-align: right;">53.9552</td><td style = "text-align: right;">0.999995</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">61</td><td style = "text-align: right;">-45.1767</td><td style = "text-align: right;">1.24889</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">62</td><td style = "text-align: right;">-115.073</td><td style = "text-align: right;">1.1414</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">63</td><td style = "text-align: right;">-173.413</td><td style = "text-align: right;">1.27369</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">64</td><td style = "text-align: right;">-112.258</td><td style = "text-align: right;">1.1467</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">65</td><td style = "text-align: right;">-15.3304</td><td style = "text-align: right;">1.07348</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">66</td><td style = "text-align: right;">2.73884</td><td style = "text-align: right;">1.09762</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">67</td><td style = "text-align: right;">-77.0061</td><td style = "text-align: right;">1.10743</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">68</td><td style = "text-align: right;">-143.814</td><td style = "text-align: right;">1.282</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">69</td><td style = "text-align: right;">-83.6906</td><td style = "text-align: right;">1.05359</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">70</td><td style = "text-align: right;">24.6125</td><td style = "text-align: right;">1.047</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">71</td><td style = "text-align: right;">-43.6636</td><td style = "text-align: right;">1.04319</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">72</td><td style = "text-align: right;">3.48193</td><td style = "text-align: right;">1.18682</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">73</td><td style = "text-align: right;">71.8681</td><td style = "text-align: right;">1.02125</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">74</td><td style = "text-align: right;">-74.6595</td><td style = "text-align: right;">1.13546</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">75</td><td style = "text-align: right;">-18.0113</td><td style = "text-align: right;">1.04395</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">76</td><td style = "text-align: right;">-22.3565</td><td style = "text-align: right;">1.07911</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">77</td><td style = "text-align: right;">-17.6853</td><td style = "text-align: right;">1.04078</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">78</td><td style = "text-align: right;">-124.59</td><td style = "text-align: right;">1.17639</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">79</td><td style = "text-align: right;">-144.426</td><td style = "text-align: right;">1.06047</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">80</td><td style = "text-align: right;">-176.595</td><td style = "text-align: right;">1.25339</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">81</td><td style = "text-align: right;">-75.618</td><td style = "text-align: right;">1.14979</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">82</td><td style = "text-align: right;">-65.6359</td><td style = "text-align: right;">1.22684</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">83</td><td style = "text-align: right;">-23.4294</td><td style = "text-align: right;">1.11736</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">84</td><td style = "text-align: right;">-12.6785</td><td style = "text-align: right;">1.02904</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">85</td><td style = "text-align: right;">-92.1693</td><td style = "text-align: right;">1.21991</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">86</td><td style = "text-align: right;">47.5661</td><td style = "text-align: right;">1.02165</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">87</td><td style = "text-align: right;">-54.4964</td><td style = "text-align: right;">1.14182</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">88</td><td style = "text-align: right;">-49.1479</td><td style = "text-align: right;">1.1195</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">89</td><td style = "text-align: right;">-95.2246</td><td style = "text-align: right;">1.35991</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">90</td><td style = "text-align: right;">-55.9432</td><td style = "text-align: right;">1.04312</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">91</td><td style = "text-align: right;">-8.93476</td><td style = "text-align: right;">1.08172</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">92</td><td style = "text-align: right;">-59.9657</td><td style = "text-align: right;">1.17252</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">93</td><td style = "text-align: right;">-81.1628</td><td style = "text-align: right;">1.17077</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">94</td><td style = "text-align: right;">38.2961</td><td style = "text-align: right;">1.16695</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">95</td><td style = "text-align: right;">-63.9988</td><td style = "text-align: right;">1.02389</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">96</td><td style = "text-align: right;">2.55989</td><td style = "text-align: right;">1.05048</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">97</td><td style = "text-align: right;">-52.4629</td><td style = "text-align: right;">1.06814</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">98</td><td style = "text-align: right;">-95.6759</td><td style = "text-align: right;">1.12482</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">99</td><td style = "text-align: right;">-231.775</td><td style = "text-align: right;">1.2294</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">100</td><td style = "text-align: right;">-188.059</td><td style = "text-align: right;">1.10577</td></tr></tbody></table></div><p>But we can also create a DataFrame for the agent and edgetypes, e.g.</p><pre><code class="language-julia hljs">DataFrame(sim, Bought)</code></pre><div><div style = "float: left;"><span>50×4 DataFrame</span></div><div style = "clear: both;"></div></div><div class = "data-frame" style = "overflow-x: scroll;"><table class = "data-frame" style = "margin-bottom: 6px;"><thead><tr class = "header"><th class = "rowNumber" style = "font-weight: bold; text-align: right;">Row</th><th style = "text-align: left;">from</th><th style = "text-align: left;">to</th><th style = "text-align: left;">x</th><th style = "text-align: left;">y</th></tr><tr class = "subheader headerLastRow"><th class = "rowNumber" style = "font-weight: bold; text-align: right;"></th><th title = "UInt64" style = "text-align: left;">UInt64</th><th title = "UInt64" style = "text-align: left;">UInt64</th><th title = "Float64" style = "text-align: left;">Float64</th><th title = "Float64" style = "text-align: left;">Float64</th></tr></thead><tbody><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">1</td><td style = "text-align: right;">72057594037927937</td><td style = "text-align: right;">144115188075855877</td><td style = "text-align: right;">40.9504</td><td style = "text-align: right;">8.80988</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">2</td><td style = "text-align: right;">72057594037927938</td><td style = "text-align: right;">144115188075855877</td><td style = "text-align: right;">23.7619</td><td style = "text-align: right;">42.0927</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">3</td><td style = "text-align: right;">72057594037927939</td><td style = "text-align: right;">144115188075855877</td><td style = "text-align: right;">2.87962</td><td style = "text-align: right;">41.0046</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">4</td><td style = "text-align: right;">72057594037927941</td><td style = "text-align: right;">144115188075855877</td><td style = "text-align: right;">10.3497</td><td style = "text-align: right;">63.9112</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">5</td><td style = "text-align: right;">72057594037927957</td><td style = "text-align: right;">144115188075855877</td><td style = "text-align: right;">19.1301</td><td style = "text-align: right;">57.3105</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">6</td><td style = "text-align: right;">72057594037927963</td><td style = "text-align: right;">144115188075855877</td><td style = "text-align: right;">31.202</td><td style = "text-align: right;">2.72387</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">7</td><td style = "text-align: right;">72057594037927967</td><td style = "text-align: right;">144115188075855877</td><td style = "text-align: right;">19.6702</td><td style = "text-align: right;">22.7118</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">8</td><td style = "text-align: right;">72057594037927973</td><td style = "text-align: right;">144115188075855877</td><td style = "text-align: right;">14.8293</td><td style = "text-align: right;">4.06023</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">9</td><td style = "text-align: right;">72057594037927975</td><td style = "text-align: right;">144115188075855877</td><td style = "text-align: right;">27.873</td><td style = "text-align: right;">22.5144</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">10</td><td style = "text-align: right;">72057594037927978</td><td style = "text-align: right;">144115188075855877</td><td style = "text-align: right;">8.07403</td><td style = "text-align: right;">9.66304</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">11</td><td style = "text-align: right;">72057594037927940</td><td style = "text-align: right;">144115188075855875</td><td style = "text-align: right;">64.9857</td><td style = "text-align: right;">7.97454</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">12</td><td style = "text-align: right;">72057594037927947</td><td style = "text-align: right;">144115188075855875</td><td style = "text-align: right;">34.1275</td><td style = "text-align: right;">45.9179</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">13</td><td style = "text-align: right;">72057594037927951</td><td style = "text-align: right;">144115188075855875</td><td style = "text-align: right;">3.87536</td><td style = "text-align: right;">146.512</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">14</td><td style = "text-align: right;">72057594037927953</td><td style = "text-align: right;">144115188075855875</td><td style = "text-align: right;">31.7995</td><td style = "text-align: right;">78.2468</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">15</td><td style = "text-align: right;">72057594037927956</td><td style = "text-align: right;">144115188075855875</td><td style = "text-align: right;">14.429</td><td style = "text-align: right;">4.0889</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">16</td><td style = "text-align: right;">72057594037927958</td><td style = "text-align: right;">144115188075855875</td><td style = "text-align: right;">13.1782</td><td style = "text-align: right;">31.5239</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">17</td><td style = "text-align: right;">72057594037927959</td><td style = "text-align: right;">144115188075855875</td><td style = "text-align: right;">1.69696</td><td style = "text-align: right;">2.07231</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">18</td><td style = "text-align: right;">72057594037927960</td><td style = "text-align: right;">144115188075855875</td><td style = "text-align: right;">16.2225</td><td style = "text-align: right;">122.104</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">19</td><td style = "text-align: right;">72057594037927964</td><td style = "text-align: right;">144115188075855875</td><td style = "text-align: right;">15.7176</td><td style = "text-align: right;">37.0276</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">20</td><td style = "text-align: right;">72057594037927968</td><td style = "text-align: right;">144115188075855875</td><td style = "text-align: right;">47.6144</td><td style = "text-align: right;">45.1436</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">21</td><td style = "text-align: right;">72057594037927970</td><td style = "text-align: right;">144115188075855875</td><td style = "text-align: right;">3.73105</td><td style = "text-align: right;">32.2351</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">22</td><td style = "text-align: right;">72057594037927971</td><td style = "text-align: right;">144115188075855875</td><td style = "text-align: right;">69.55</td><td style = "text-align: right;">8.66757</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">23</td><td style = "text-align: right;">72057594037927985</td><td style = "text-align: right;">144115188075855875</td><td style = "text-align: right;">19.4057</td><td style = "text-align: right;">40.7043</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">24</td><td style = "text-align: right;">72057594037927943</td><td style = "text-align: right;">144115188075855874</td><td style = "text-align: right;">29.1279</td><td style = "text-align: right;">37.4819</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">25</td><td style = "text-align: right;">72057594037927945</td><td style = "text-align: right;">144115188075855874</td><td style = "text-align: right;">34.2309</td><td style = "text-align: right;">46.1359</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">26</td><td style = "text-align: right;">72057594037927950</td><td style = "text-align: right;">144115188075855874</td><td style = "text-align: right;">15.6671</td><td style = "text-align: right;">21.7484</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">27</td><td style = "text-align: right;">72057594037927952</td><td style = "text-align: right;">144115188075855874</td><td style = "text-align: right;">30.6474</td><td style = "text-align: right;">6.71612</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">28</td><td style = "text-align: right;">72057594037927954</td><td style = "text-align: right;">144115188075855874</td><td style = "text-align: right;">52.6785</td><td style = "text-align: right;">41.81</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">29</td><td style = "text-align: right;">72057594037927961</td><td style = "text-align: right;">144115188075855874</td><td style = "text-align: right;">31.4887</td><td style = "text-align: right;">50.8314</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">30</td><td style = "text-align: right;">72057594037927966</td><td style = "text-align: right;">144115188075855874</td><td style = "text-align: right;">8.21127</td><td style = "text-align: right;">37.3773</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">31</td><td style = "text-align: right;">72057594037927972</td><td style = "text-align: right;">144115188075855874</td><td style = "text-align: right;">43.6349</td><td style = "text-align: right;">30.572</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">32</td><td style = "text-align: right;">72057594037927974</td><td style = "text-align: right;">144115188075855874</td><td style = "text-align: right;">9.11683</td><td style = "text-align: right;">28.7125</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">33</td><td style = "text-align: right;">72057594037927981</td><td style = "text-align: right;">144115188075855874</td><td style = "text-align: right;">11.41</td><td style = "text-align: right;">13.2878</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">34</td><td style = "text-align: right;">72057594037927944</td><td style = "text-align: right;">144115188075855873</td><td style = "text-align: right;">13.8713</td><td style = "text-align: right;">3.55402</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">35</td><td style = "text-align: right;">72057594037927946</td><td style = "text-align: right;">144115188075855873</td><td style = "text-align: right;">14.7618</td><td style = "text-align: right;">3.61752</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">36</td><td style = "text-align: right;">72057594037927948</td><td style = "text-align: right;">144115188075855873</td><td style = "text-align: right;">0.111122</td><td style = "text-align: right;">2.25516</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">37</td><td style = "text-align: right;">72057594037927962</td><td style = "text-align: right;">144115188075855873</td><td style = "text-align: right;">60.7055</td><td style = "text-align: right;">9.44921</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">38</td><td style = "text-align: right;">72057594037927965</td><td style = "text-align: right;">144115188075855873</td><td style = "text-align: right;">53.4993</td><td style = "text-align: right;">21.7467</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">39</td><td style = "text-align: right;">72057594037927969</td><td style = "text-align: right;">144115188075855873</td><td style = "text-align: right;">0.377197</td><td style = "text-align: right;">2.10087</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">40</td><td style = "text-align: right;">72057594037927976</td><td style = "text-align: right;">144115188075855873</td><td style = "text-align: right;">40.0807</td><td style = "text-align: right;">25.4689</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">41</td><td style = "text-align: right;">72057594037927979</td><td style = "text-align: right;">144115188075855873</td><td style = "text-align: right;">1.78505</td><td style = "text-align: right;">4.18396</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">42</td><td style = "text-align: right;">72057594037927983</td><td style = "text-align: right;">144115188075855873</td><td style = "text-align: right;">27.1858</td><td style = "text-align: right;">13.23</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">43</td><td style = "text-align: right;">72057594037927942</td><td style = "text-align: right;">144115188075855876</td><td style = "text-align: right;">8.9366</td><td style = "text-align: right;">12.8248</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">44</td><td style = "text-align: right;">72057594037927949</td><td style = "text-align: right;">144115188075855876</td><td style = "text-align: right;">45.0786</td><td style = "text-align: right;">26.7966</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">45</td><td style = "text-align: right;">72057594037927955</td><td style = "text-align: right;">144115188075855876</td><td style = "text-align: right;">2.71562</td><td style = "text-align: right;">20.6366</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">46</td><td style = "text-align: right;">72057594037927977</td><td style = "text-align: right;">144115188075855876</td><td style = "text-align: right;">2.45816</td><td style = "text-align: right;">6.73847</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">47</td><td style = "text-align: right;">72057594037927980</td><td style = "text-align: right;">144115188075855876</td><td style = "text-align: right;">62.2311</td><td style = "text-align: right;">11.9973</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">48</td><td style = "text-align: right;">72057594037927982</td><td style = "text-align: right;">144115188075855876</td><td style = "text-align: right;">16.5926</td><td style = "text-align: right;">39.8916</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">49</td><td style = "text-align: right;">72057594037927984</td><td style = "text-align: right;">144115188075855876</td><td style = "text-align: right;">25.4126</td><td style = "text-align: right;">8.68526</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">50</td><td style = "text-align: right;">72057594037927986</td><td style = "text-align: right;">144115188075855876</td><td style = "text-align: right;">54.6611</td><td style = "text-align: right;">14.9185</td></tr></tbody></table></div><h1 id="Finish-the-simulation"><a class="docs-heading-anchor" href="#Finish-the-simulation">Finish the simulation</a><a id="Finish-the-simulation-1"></a><a class="docs-heading-anchor-permalink" href="#Finish-the-simulation" title="Permalink"></a></h1><p>Vahana uses internally a C library and also allocates memory via this library. So when you have finished your simulation and want to free the memory, you must call <code>finish_simulation</code>.</p><pre><code class="language-julia hljs">finish_simulation!(sim)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">Globals([-236.9346312632883, -1.404587779980222, 43.00996669128081, -31.731211423033212, -135.70786101725062, -107.73770741341686, -22.25338126721734, -1.2532442017632022, -100.05615841327179, -64.74128057178794  …  -8.934759309490818, -59.965665860079056, -81.16282203375874, 38.29612366398816, -63.99882608423696, 2.559891480388359, -52.46294851923443, -95.67592675277727, -231.77533294462637, -188.05892168707143], [1.0666326873349843, 1.0634148700186667, 1.0908195532299567, 1.091374500613633, 1.059723837318109, 1.0824272522646268, 1.0335296404277223, 1.0777911787147367, 1.0732327180084271, 1.1435775883577877  …  1.081723829800091, 1.1725202363379728, 1.1707700345927168, 1.1669543742581443, 1.0238904509319684, 1.0504798702176297, 1.0681438338777325, 1.1248155972090716, 1.229396889829005, 1.1057673080582302])</code></pre><hr/><p><em>This page was generated using <a href="https://github.com/fredrikekre/Literate.jl">Literate.jl</a>.</em></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="index.html">« Introduction</a><a class="docs-footer-nextpage" href="hegselmann.html">Opinion Model »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.25 on <span class="colophon-date" title="Thursday 11 January 2024 16:57">Thursday 11 January 2024</span>. Using Julia version 1.9.4.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
