<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Model Definition · Vahana Documentation</title><script data-outdated-warner src="assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="assets/documenter.js"></script><script src="siteinfo.js"></script><script src="../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="index.html">Vahana Documentation</a></span></div><form class="docs-search" action="search.html"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="index.html">Introduction</a></li><li><span class="tocitem">Tutorials</span><ul><li><a class="tocitem" href="tutorial1.html">Tutorial</a></li><li><a class="tocitem" href="hegselmann.html">Opinion Model</a></li><li><a class="tocitem" href="predator.html">Predator / Prey</a></li></ul></li><li><a class="tocitem" href="performance.html">Performance Tuning</a></li><li><span class="tocitem">API</span><ul><li class="is-active"><a class="tocitem" href="definition.html">Model Definition</a><ul class="internal"><li><a class="tocitem" href="#Construct-the-Model"><span>Construct the Model</span></a></li><li class="toplevel"><a class="tocitem" href="#Create-a-Simulation"><span>Create a Simulation</span></a></li></ul></li><li><a class="tocitem" href="initialization.html">Initialization</a></li><li><a class="tocitem" href="transition.html">Transition Function</a></li><li><a class="tocitem" href="global.html">Global Layer</a></li><li><a class="tocitem" href="plots.html">Plots</a></li><li><a class="tocitem" href="hdf5.html">HDF5</a></li><li><a class="tocitem" href="logging.html">Logging</a></li><li><a class="tocitem" href="config.html">Configuration</a></li><li><a class="tocitem" href="misc.html">Misc</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">API</a></li><li class="is-active"><a href="definition.html">Model Definition</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href="definition.html">Model Definition</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/s-fuerst/Vahana.jl/blob/c02d2564f4804321a030013a987b6d798a9d0f40/docs/src/definition.md" title="View on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">View on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Model-Definition"><a class="docs-heading-anchor" href="#Model-Definition">Model Definition</a><a id="Model-Definition-1"></a><a class="docs-heading-anchor-permalink" href="#Model-Definition" title="Permalink"></a></h1><p>This page describes all the functions and structures used to define the model and to create an uninitialized simulation. In Vahana the simulation state and the transition functions that changes the state are decoupled, therefore we do not need to define the transition functions before we create the simulation. </p><p>The usual workflow is as follows:</p><ul><li>Define all Agent and Edge types</li><li>Create a <a href="definition.html#Vahana.ModelTypes"><code>ModelTypes</code></a> instance</li><li>Register the defined Agent and Edge types </li><li>Call <a href="definition.html#Vahana.create_model"><code>create_model</code></a> to create an model (state space) object</li><li>Call <a href="definition.html#Vahana.create_simulation"><code>create_simulation</code></a> to create an uninitialized simulation of this model</li></ul><p>The simplest example for such a workflow is:</p><pre><code class="nohighlight hljs">struct Agent end
struct EdgeState end

const sim = ModelTypes() |&gt;
    register_agenttype!(Agent) |&gt;
    register_edgetype!(EdgeState) |&gt;
    create_model(&quot;Minimal Example&quot;) |&gt;
    create_simulation()</code></pre><p>After the simulation is created, the next step is its initialization, which is described on the <a href="initialization.html">next</a> page.</p><h2 id="Construct-the-Model"><a class="docs-heading-anchor" href="#Construct-the-Model">Construct the Model</a><a id="Construct-the-Model-1"></a><a class="docs-heading-anchor-permalink" href="#Construct-the-Model" title="Permalink"></a></h2><p>Before we can construct a model, we need to register all agent and edge types. </p><article class="docstring"><header><a class="docstring-binding" id="Vahana.ModelTypes" href="#Vahana.ModelTypes"><code>Vahana.ModelTypes</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">ModelTypes</code></pre><p>This struct stores all (internal) information about the agent and edge types of the model and is therefore the starting point of the model definition. </p><p>Call the ModelType constructor without parameters, and then use the created object as the first parameter in <a href="definition.html#Vahana.register_agenttype!"><code>register_agenttype!</code></a> and <a href="definition.html#Vahana.register_edgetype!"><code>register_edgetype!</code></a>, whereby the |&gt; operator can be used to concatenate these registrations.</p><p>See also <a href="definition.html#Vahana.create_model"><code>create_model</code></a>,</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/s-fuerst/Vahana.jl/blob/c02d2564f4804321a030013a987b6d798a9d0f40/src/ModelTypes.jl#L4-L17">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="Vahana.register_agenttype!" href="#Vahana.register_agenttype!"><code>Vahana.register_agenttype!</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">register_agenttype!(types::ModelTypes, ::Type{T}, [hints...])</code></pre><p>Register an additional agent type to <code>types</code>. </p><p>An agent type is a struct that define the state space for agents of type <code>T</code>. These structs must be &quot;bits types&quot;, meaning the type is immutable and contains only primitive types and other bits types.</p><p>By default, it is assumed that an agent can die (be removed from the simulation) by returning <code>nothing</code> in the transition function (see <a href="transition.html#Vahana.apply!"><code>apply!</code></a>. In the case that agents are never removed, the hint :Immortal can be given to improve the performance of the simulation.</p><p>See also <a href="initialization.html#Vahana.add_agent!"><code>add_agent!</code></a> and <a href="initialization.html#Vahana.add_agents!"><code>add_agents!</code></a> </p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/s-fuerst/Vahana.jl/blob/c02d2564f4804321a030013a987b6d798a9d0f40/src/ModelTypes.jl#L38-L53">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="Vahana.register_edgetype!" href="#Vahana.register_edgetype!"><code>Vahana.register_edgetype!</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">register_edgetype!(types::ModelTypes, ::Type{T}, [hints...; kwargs...])</code></pre><p>Register an additional edge type to <code>types</code>. </p><p>An edge type T is a structure that defines the state (field) of <a href="initialization.html#Vahana.Edge"><code>Edge{T}</code></a>.  These structs must be &quot;bit types&quot;, that is, the type is immutable and contains only primitive types and other bit types. Often these types T are stateless, in which case they are used as a tag to distinguish between the existing types of edges of the model.</p><p>The internal data structures used to store the graph in memory can be modified by  the hints parameters:</p><ul><li><code>:IgnoreFrom</code>: The ID of the source agent is not stored. This implies that the state of the agents on the source of the edge is not accessible via e.g. the <a href="transition.html#Vahana.neighborstates"><code>neighborstates</code></a> function.</li><li><code>:Stateless</code>: Store only the ID of the source agent. </li><li><code>:SingleType</code>: All target agents have the same type, needs also keyword <code>target</code> (see below).</li><li><code>:SingleEdge</code>: Each agent can be the target for max. one edge.</li><li><code>:IgnoreSourceState</code>: The ID of the source agent is not used to access the state of the agent with this ID.</li><li><code>:NumEdgesOnly</code>: Combines <code>:IgnoreFrom</code> and <code>:Stateless</code></li><li><code>:HasEdgeOnly</code>: Combines <code>:IgnoreFrom</code>, <code>:Stateless</code> and <code>:SingleEdge</code></li></ul><p>If <code>:SingleType</code> is set, the keyword argument <code>target</code> must be added. The value of this argument must be the type of the target node. If the <code>target</code> keyword exists, but the <code>:SingleType</code> hint is not explicitly specified, it will be set implicitly</p><p>If it is known how many agents of this type exist, this can also be specified via the optional <code>size</code> keyword. This can improve performance, but can also increase the memory usage.</p><p>See also <a href="performance.html#Edge-Hints">Edge Hints</a>, <a href="initialization.html#Vahana.add_edge!"><code>add_edge!</code></a> and  <a href="initialization.html#Vahana.add_edges!"><code>add_edges!</code></a> </p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/s-fuerst/Vahana.jl/blob/c02d2564f4804321a030013a987b6d798a9d0f40/src/ModelTypes.jl#L88-L126">source</a></section></article><p>We can then use the <code>ModelTypes</code> instance to construct the model. Which means that optimized methods that can be used to access or modify the simulation state during the transition function are generated. See <a href="performance.html">Performance Tuning</a> for details.</p><div class="admonition is-success"><header class="admonition-header">Tip</header><div class="admonition-body"><p>As <a href="definition.html#Vahana.create_model"><code>create_model</code></a> adds new methods, it increments the <a href="https://docs.julialang.org/en/v1/manual/methods/#Redefining-Methods">&quot;world age counter&quot;</a>. This means, that you can not construct the model in the same function as you initialize it. But you can call <a href="definition.html#Vahana.create_simulation"><code>create_simulation</code></a> in the same function so</p><pre><code class="nohighlight hljs">const model = create_model(modeltypes, &quot;Minimal Example&quot;) 

function create_and_init()
	sim = create_simulation(model, nothing, nothing)
	add_agent!(sim, Agent())
end</code></pre><p>is valid code. </p></div></div><article class="docstring"><header><a class="docstring-binding" id="Vahana.create_model" href="#Vahana.create_model"><code>Vahana.create_model</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">create_model(types::ModelTypes, name::String)</code></pre><p>Creates a struct that is a subtype of the <code>Simulation</code> type and methods corresponding to the type information of <code>types</code> to the Julia session. The new structure is named <code>name</code>, and all methods are specific to this structure using Julia&#39;s multiple dispatch concept, so it is possible to have different models in the same Julia session (as long as <code>name</code> is different).</p><p>Returns a <a href="definition.html#Vahana.Model"><code>Model</code></a> that can be used in <a href="definition.html#Vahana.create_simulation"><code>create_simulation</code></a> to create a concrete simulation.  </p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/s-fuerst/Vahana.jl/blob/c02d2564f4804321a030013a987b6d798a9d0f40/src/Simulation.jl#L91-L103">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="Vahana.Model" href="#Vahana.Model"><code>Vahana.Model</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">Model</code></pre><p>A Model instance is created by <a href="definition.html#Vahana.create_model"><code>create_model</code></a> and can then be used to create one or multiple simulations via <a href="definition.html#Vahana.create_simulation"><code>create_simulation</code></a>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/s-fuerst/Vahana.jl/blob/c02d2564f4804321a030013a987b6d798a9d0f40/src/ModelTypes.jl#L27-L32">source</a></section></article><h1 id="Create-a-Simulation"><a class="docs-heading-anchor" href="#Create-a-Simulation">Create a Simulation</a><a id="Create-a-Simulation-1"></a><a class="docs-heading-anchor-permalink" href="#Create-a-Simulation" title="Permalink"></a></h1><article class="docstring"><header><a class="docstring-binding" id="Vahana.create_simulation" href="#Vahana.create_simulation"><code>Vahana.create_simulation</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">create_simulation(model::Model, [params = nothing, globals = nothing; name = model.name, filename = name, overwrite_file = true, logging = false, debug = false])</code></pre><p>Creates and return a new simulation object, which stores the complete state  of a simulation. </p><p><code>model</code> is an <code>Model</code> instance created by <a href="definition.html#Vahana.create_model"><code>create_model</code></a>.</p><p><code>params</code> must be a struct (or <code>nothing</code>) that contains all parameters of a simulation. Parameter values are constant in a simulation run and can be retrieved via the <a href="transition.html#Vahana.param"><code>param</code></a> function.</p><p><code>globals</code> must be a mutable struct (or <code>nothing</code>). The values of these fields are accessible for all agents via the <a href="transition.html#Vahana.get_global"><code>get_global</code></a> function. The values can be changed by calling <a href="global.html#Vahana.set_global!"><code>set_global!</code></a> or <a href="global.html#Vahana.push_global!"><code>push_global!</code></a>. </p><p>The optional keyword argument <code>name</code> is used as meta-information about the simulation and has no effect on the dynamics, since <code>name</code> is not accessible in the transition functions. If <code>name</code> is not given, the name of the model is used instead.</p><p>The optional <code>filename</code> keyword is a string that will be used as the name of the hdf5 file when a simulation or a part of it is written via e.g. <a href="hdf5.html#Vahana.write_snapshot"><code>write_snapshot</code></a>. </p><p>The file is created when a <code>write...</code> function is called for the first time, and it is created in an <code>h5</code> subfolder. By default an existing file with the same <code>filename</code> will be overwritten, but this behavior can be disabled with the <code>overwrite_file</code> keyword, in which case the files will be numbered. If <code>filename</code> is not provided, the <code>name</code> argument is used instead.</p><p>The keywords <code>logging</code> is a boolean flag that enables an automatical log file.  The log file contains information such as the time spent in different functions. When also <code>debug</code> is set to true, the log file contains more details and the stream will be flushed after each write.</p><p>As with the hdf5 files, overwrite_file <code>the</code> keyword determines whether the log files are overwritten or numbered. The numbering is set independently from the numbering of the hdf5 files.</p><p>The simulation starts in an uninitialized state. After adding the agents and edges for the initial state, it is necessary to call <a href="initialization.html#Vahana.finish_init!"><code>finish_init!</code></a> before applying a transition function for the first time.</p><p>See also <a href="definition.html#Vahana.create_model"><code>create_model</code></a>, <a href="transition.html#Vahana.param"><code>param</code></a>, <a href="transition.html#Vahana.get_global"><code>get_global</code></a>, <a href="global.html#Vahana.set_global!"><code>set_global!</code></a>, <a href="global.html#Vahana.push_global!"><code>push_global!</code></a> and <a href="initialization.html#Vahana.finish_init!"><code>finish_init!</code></a></p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/s-fuerst/Vahana.jl/blob/c02d2564f4804321a030013a987b6d798a9d0f40/src/Simulation.jl#L169-L218">source</a></section></article></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="performance.html">« Performance Tuning</a><a class="docs-footer-nextpage" href="initialization.html">Initialization »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.25 on <span class="colophon-date" title="Monday 15 January 2024 14:08">Monday 15 January 2024</span>. Using Julia version 1.9.4.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
